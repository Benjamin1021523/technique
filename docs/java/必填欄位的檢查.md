---
title: 必填欄位的檢查
---
<!--關鍵字: spring boot, spring-validation, 必填欄位-->

# 必填欄位的檢查

為了確保程式功能正常運作，檢查參數是否有值、是否在範圍內是必要的。

使用spring validation可以簡化這個步驟，透過一些方式設定如何檢查，而不是在程式內剪貼if else判斷。

API輸入參數需要檢查時，個人認為沒有不適合的情境

## 使用套件

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-validation</artifactId>
    <version>3.5.4</version>
</dependency>
```

## 簡單的範例

透過`@Valid`和各種validation註解來檢查必填欄位

使用`@Slf4j`寫入執行紀錄

```java
@RestController
@Slf4j
public class UserController {

    @PostMapping("/users")
    public ResponseEntity<String> createUser(@Valid @RequestBody CreateUserInput input) {
        log.info("創建用戶: {}", input.getName());
        return ResponseEntity.ok("用戶創建成功");
    }
}

@Data
public class CreateUserInput {
    @NotBlank(message = "姓名不能為空")
    private String name;
    
    @NotNull(message = "年齡不能為null")
    @Min(value = 0, message = "年齡不能小於0")
    @Max(value = 150, message = "年齡不能大於150")
    private Integer age;
    
    @Email(message = "電子郵件格式不正確")
    @NotBlank(message = "電子郵件不能為空")
    private String email;
}
```

使用`@Valid`註解會自動觸發validation檢查，如果檢查失敗會拋出`MethodArgumentNotValidException`

### 常用的validation註解

| 註解 | 用途                         | 範例 |
|------|----------------------------|------|
| `@NotNull` | 檢查不為null                   | `@NotNull(message = "ID不能為null")` |
| `@NotBlank` | 檢查不為null且不為空字串             | `@NotBlank(message = "姓名不能為空")` |
| `@NotEmpty` | 檢查不為null且不為空集合             | `@NotEmpty(message = "列表不能為空")` |
| `@Min` | 檢查數值最小值                    | `@Min(value = 0, message = "年齡不能小於0")` |
| `@Max` | 檢查數值最大值                    | `@Max(value = 100, message = "分數不能大於100")` |
| `@Email` | 檢查電子郵件格式(使用套件定義的email格式檢查) | `@Email(message = "電子郵件格式不正確")` |
| `@Pattern` | 檢查正則表達式(自定義格式)             | `@Pattern(regexp = "^[0-9]{10}$", message = "手機號碼格式不正確")` |

其他annotation可以查詢library下的`jakarta.validation.constraints`內的class

## 全域異常處理

為了統一處理validation錯誤，可以建立全域異常處理器

```java
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<Map<String, Object>> handleValidationException(
            MethodArgumentNotValidException ex) {
        
        Map<String, Object> response = new HashMap<>();
        List<String> errors = new ArrayList<>();
        
        ex.getBindingResult().getFieldErrors().forEach(error -> {
            errors.add(error.getField() + ": " + error.getDefaultMessage());
        });
        
        response.put("message", "參數驗證失敗");
        response.put("errors", errors);
        
        log.warn("參數驗證失敗: {}", errors);
        
        return ResponseEntity.badRequest().body(response);
    }
}
```

## 使用的好處

* 提供統一的錯誤回應格式
* 透過避免新增手動檢查參數的程式碼，減少重複程式
* 增加可讀性，後續維護時可從傳入物件的欄位確認此API參數的規則。

<!--Finish-->

